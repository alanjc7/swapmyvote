= javascript_pack_tag "intlTelInput"
= stylesheet_pack_tag "intlTelInput"

.background-pattern.border-bottom
  .container.container-narrow
    .card
      .card-header
        %h2.h4.mb-0
          Edit profile
      .card-body
        - if @user.swapped?
          %p.text-center.text-warning.small
            Warning: Changing your party preferences or constituency will undo any swap that
            you have agreed to.

        = form_for @user, url: user_path do |f|
          .form-group
            %label.mb-0 My preferred party is
            = f.collection_select :preferred_party_id, @parties,
                                  :id, :name,
                                  { prompt: "...",
                                    selected: @user.preferred_party_id },
                                  { class: "form-control" }

          .form-group
            %label.mb-0 but I'm willing to vote for
            = f.collection_select :willing_party_id, @parties,
                                  :id, :name,
                                  { prompt: "...",
                                    selected: @user.willing_party_id },
                                  { class: "form-control" }

          .form-group
            %label.mb-0 My constituency is
            %br
            = f.collection_select :constituency_ons_id, @constituencies,
                                  :ons_id, :name,
                                  { prompt: "...",
                                    selected: @user.constituency_ons_id },
                                  { class: "form-control" }

          .form-group
            %label.mb-0 My email address is
            = f.text_field :email, placeholder: "me@example.com", autofocus: true, class: "form-control"

          .form-group
            %label.mb-0 My phone number is
            %br
            = telephone_field_tag "mobile_phone[number]", @mobile_number, class: "form-control"

            - if @mobile_number.present?
              - if mobile_verified?
                Verified!
              - else
                = button_tag "Verify", formaction: verify_mobile_path,
                            formmethod: :get, class: "btn btn-primary"

          %p.subdued.small

            We only need your email to let you know when we've found a
            swap partner for you, and your phone number to prevent
            people creating fake accounts. No spam, and your details
            will stay private with us.

          %p.text-center
            = submit_tag("Save", class: "btn btn-primary btn-block")

        %hr
          %p.small.subdued
            If you no longer want to take part in Swap My Vote, you can delete your account
            =link_to "here", confirm_account_deletion_path
